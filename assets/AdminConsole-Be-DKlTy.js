import{j as e,m as D}from"./motion-Bqg1F435.js";import{r as n}from"./charts-BdExecV6.js";import{s as N,r as h,b as f,p as _}from"./index-DWYd_aK1.js";import{o as q,d as ee,b,T as F,c as R,e as y,f as se,j as ae,U as te,h as ie,M as T,R as ne,C as le}from"./icons-BKnbkRve.js";import"./react-vendor-vtvkNrF5.js";import"./supabase-Zg5kSs2N.js";const pe=({onBack:z})=>{const[l,c]=n.useState([]),[B,S]=n.useState([]),[o,L]=n.useState(""),[j,I]=n.useState("All"),[u,E]=n.useState("All"),[g,U]=n.useState("All"),[v,H]=n.useState({}),[d,$]=n.useState({}),[r,C]=n.useState({}),[m,p]=n.useState({status:"busy",message:"Currently working on several high-priority projects.",estimatedWaitTime:"2-3 weeks"}),[M,O]=n.useState(!0),[w,k]=n.useState(!1),[P,W]=n.useState(null);n.useEffect(()=>{(async()=>{try{const[i,x]=await Promise.all([h.getAllRequests(),f.getBacklogStatus()]);c(i),S(i),p(x)}catch(i){console.error("Failed to fetch data:",i)}finally{O(!1)}})();const t=N.subscribeToRequests(()=>{h.getAllRequests().then(c)}),a=N.subscribeToBacklogStatus(()=>{f.getBacklogStatus().then(p)});return()=>{t&&N.unsubscribe(t),a&&N.unsubscribe(a)}},[]),n.useEffect(()=>{let s=l;o&&(s=s.filter(t=>t.title.toLowerCase().includes(o.toLowerCase())||t.description.toLowerCase().includes(o.toLowerCase())||t.userName.toLowerCase().includes(o.toLowerCase()))),j!=="All"&&(s=s.filter(t=>t.department===j)),u!=="All"&&(s=s.filter(t=>t.priority===u)),g!=="All"&&(s=s.filter(t=>t.status===g)),S(s)},[o,j,u,g,l]);const K=async(s,t)=>{try{await h.updateRequest(s,{status:t}),c(a=>a.map(i=>i.id===s?{...i,status:t}:i))}catch(a){console.error("Failed to update status:",a),alert("Failed to update status. Please try again.")}},X=async(s,t)=>{try{await h.updateRequest(s,{progress:t}),c(a=>a.map(i=>i.id===s?{...i,progress:t}:i))}catch(a){console.error("Failed to update progress:",a),alert("Failed to update progress. Please try again.")}},G=async(s,t)=>{const a=t!==void 0?t:v[s];try{await h.updateRequest(s,{adminNotes:a}),c(i=>i.map(x=>x.id===s?{...x,adminNotes:a}:x))}catch(i){console.error("Failed to save notes:",i),alert("Failed to save notes. Please try again.")}},J=async()=>{k(!0);try{await f.updateBacklogStatus(m),alert("Backlog status updated successfully!")}catch(s){console.error("Failed to update backlog status:",s),alert("Failed to update backlog status. Please try again.")}finally{k(!1)}},Q=async s=>{try{await _.createProjectFromRequest(s),await h.updateRequest(s.id,{status:"In Progress",adminNotes:`${s.adminNotes||""}

[Converted to project on ${new Date().toLocaleDateString()}]`});const t=l.map(a=>a.id===s.id?{...a,status:"In Progress",adminNotes:`${a.adminNotes||""}

[Converted to project on ${new Date().toLocaleDateString()}]`}:a);c(t),alert("Successfully converted request to project!")}catch(t){console.error("Failed to convert request to project:",t),alert("Failed to convert request to project. Please try again.")}},V=s=>{W(P===s?null:s)},A=(s,t)=>{const a=d[s]||[];$({...d,[s]:[...a,{text:t,timestamp:new Date}]})},Y=s=>{switch(s){case"Planning":return e.jsx(b,{size:16,className:"status-icon planning"});case"In Progress":return e.jsx(F,{size:16,className:"status-icon in-progress"});case"Testing":return e.jsx(le,{size:16,className:"status-icon testing"});case"Complete":return e.jsx(R,{size:16,className:"status-icon complete"});case"On Hold":return e.jsx(y,{size:16,className:"status-icon on-hold"});case"Denied":return e.jsx(y,{size:16,className:"status-icon denied"});default:return e.jsx(b,{size:16,className:"status-icon"})}},Z=s=>{switch(s){case"clear":return"#22C55E";case"busy":return"#F59E0B";case"swamped":return"#EF4444";default:return"#6B7280"}};return M?e.jsx("div",{className:"admin-console",children:e.jsxs("div",{className:"admin-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading admin console..."})]})}):e.jsxs("div",{className:"admin-console",children:[e.jsxs("div",{className:"admin-header",children:[e.jsxs("button",{onClick:z,className:"back-button",children:[e.jsx(q,{size:20}),"Back to Dashboard"]}),e.jsx("h1",{children:"Admin Console"})]}),e.jsxs("div",{className:"admin-metrics",children:[e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon total",children:e.jsx(ee,{size:24})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("h3",{children:l.length}),e.jsx("p",{children:"Total Requests"})]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon pending",children:e.jsx(b,{size:24})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("h3",{children:l.filter(s=>s.status==="Planning").length}),e.jsx("p",{children:"Pending Review"})]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon in-progress",children:e.jsx(F,{size:24})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("h3",{children:l.filter(s=>s.status==="In Progress").length}),e.jsx("p",{children:"In Progress"})]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon complete",children:e.jsx(R,{size:24})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("h3",{children:l.filter(s=>s.status==="Complete").length}),e.jsx("p",{children:"Completed"})]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon denied",children:e.jsx(y,{size:24})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("h3",{children:l.filter(s=>s.status==="Denied").length}),e.jsx("p",{children:"Denied"})]})]})]}),e.jsxs("div",{className:"backlog-management",children:[e.jsx("h2",{children:"Backlog Status"}),e.jsxs("div",{className:"backlog-controls",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{children:"Current Status"}),e.jsxs("select",{value:m.status,onChange:s=>p(t=>({...t,status:s.target.value})),style:{borderColor:Z(m.status)},children:[e.jsx("option",{value:"clear",children:"Clear - Ready for new requests"}),e.jsx("option",{value:"busy",children:"Busy - Limited availability"}),e.jsx("option",{value:"swamped",children:"Swamped - High wait times"})]})]}),e.jsxs("div",{className:"control-group",children:[e.jsx("label",{children:"Status Message"}),e.jsx("textarea",{value:m.message,onChange:s=>p(t=>({...t,message:s.target.value})),placeholder:"Describe current workload...",rows:2})]}),e.jsxs("div",{className:"control-group",children:[e.jsx("label",{children:"Estimated Wait Time"}),e.jsx("input",{type:"text",value:m.estimatedWaitTime,onChange:s=>p(t=>({...t,estimatedWaitTime:s.target.value})),placeholder:"e.g., 2-3 weeks"})]}),e.jsx("button",{onClick:J,disabled:w,className:"update-backlog-btn",children:w?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner-small"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{size:16}),"Update Status"]})})]})]}),e.jsxs("div",{className:"filters-section",children:[e.jsxs("div",{className:"search-bar",children:[e.jsx(ae,{size:20}),e.jsx("input",{type:"text",placeholder:"Search requests...",value:o,onChange:s=>L(s.target.value)})]}),e.jsxs("div",{className:"filter-controls",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Department"}),e.jsxs("select",{value:j,onChange:s=>I(s.target.value),children:[e.jsx("option",{value:"All",children:"All Departments"}),e.jsx("option",{value:"Patient Care",children:"Patient Care"}),e.jsx("option",{value:"Medical Records",children:"Medical Records"}),e.jsx("option",{value:"Billing",children:"Billing"}),e.jsx("option",{value:"Clinical Research",children:"Clinical Research"}),e.jsx("option",{value:"Operations",children:"Operations"}),e.jsx("option",{value:"IT Systems",children:"IT Systems"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Priority"}),e.jsxs("select",{value:u,onChange:s=>E(s.target.value),children:[e.jsx("option",{value:"All",children:"All Priorities"}),e.jsx("option",{value:"High",children:"High"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"Low",children:"Low"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Status"}),e.jsxs("select",{value:g,onChange:s=>U(s.target.value),children:[e.jsx("option",{value:"All",children:"All Status"}),e.jsx("option",{value:"Planning",children:"Planning"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Testing",children:"Testing"}),e.jsx("option",{value:"Complete",children:"Complete"}),e.jsx("option",{value:"On Hold",children:"On Hold"}),e.jsx("option",{value:"Denied",children:"Denied"})]})]})]})]}),e.jsx("div",{className:"request-management",children:e.jsx("div",{className:"request-cards-grid",children:B.map(s=>{const t=P===s.id;return e.jsxs(D.div,{className:`request-card ${t?"expanded":""}`,layout:!0,transition:{duration:.3,ease:[.4,0,.2,1]},children:[e.jsxs("div",{className:"card-preview",onClick:()=>V(s.id),children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("div",{className:"card-badges",children:[Y(s.status),e.jsx("span",{className:"department-badge",children:s.department})]}),e.jsx("span",{className:`priority-badge ${s.priority.toLowerCase()}`,children:s.priority})]}),e.jsx("h3",{className:"card-title",children:s.title}),e.jsx("p",{className:"card-description",children:s.description}),e.jsxs("div",{className:"card-metadata",children:[e.jsxs("div",{className:"metadata-row",children:[e.jsx(te,{size:14}),e.jsx("span",{children:s.userName.split(" ")[0]})]}),e.jsxs("div",{className:"metadata-row",children:[e.jsx(ie,{size:14}),e.jsx("span",{children:new Date(s.submittedAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"card-footer",children:[e.jsxs("div",{className:"progress-indicator",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${s.progress||0}%`}})}),e.jsxs("span",{className:"progress-text",children:[s.progress||0,"%"]})]}),d[s.id]&&d[s.id].length>0&&e.jsxs("div",{className:"update-indicator",children:[e.jsx(T,{size:14}),e.jsx("span",{children:d[s.id].length})]})]})]}),t&&e.jsxs(D.div,{className:"card-expanded-content",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:[e.jsxs("div",{className:"expanded-section",children:[e.jsx("h4",{children:"Full Description"}),e.jsx("p",{children:s.description})]}),e.jsxs("div",{className:"expanded-section",children:[e.jsx("h4",{children:"Estimated Impact"}),e.jsx("p",{children:s.estimatedImpact})]}),e.jsxs("div",{className:"expanded-section",children:[e.jsx("h4",{children:"Contact Information"}),e.jsx("p",{children:s.contactInfo})]}),e.jsxs("div",{className:"admin-controls-section",children:[e.jsx("h4",{children:"Admin Controls"}),e.jsxs("div",{className:"controls-grid",children:[e.jsxs("div",{className:"control-item",children:[e.jsx("label",{children:"Status"}),e.jsxs("select",{value:s.status,onChange:a=>K(s.id,a.target.value),onClick:a=>a.stopPropagation(),children:[e.jsx("option",{value:"Planning",children:"Planning"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Testing",children:"Testing"}),e.jsx("option",{value:"Complete",children:"Complete"}),e.jsx("option",{value:"On Hold",children:"On Hold"}),e.jsx("option",{value:"Denied",children:"Denied"})]})]}),e.jsxs("div",{className:"control-item",children:[e.jsx("label",{children:"Progress"}),e.jsxs("div",{className:"progress-control",children:[e.jsxs("div",{className:"progress-bar-wrapper",children:[e.jsx("input",{type:"range",min:"0",max:"100",value:s.progress,onChange:a=>X(s.id,parseInt(a.target.value)),onClick:a=>a.stopPropagation(),className:"progress-slider"}),e.jsx("div",{className:"progress-track-fill",style:{width:`${s.progress}%`}})]}),e.jsxs("div",{className:"progress-value",children:[s.progress,"%"]})]})]})]}),e.jsxs("div",{className:"notes-section",children:[e.jsx("label",{children:"Admin Notes"}),e.jsx("textarea",{value:v[s.id]||s.adminNotes||"",onChange:a=>H({...v,[s.id]:a.target.value}),onBlur:()=>G(s.id,v[s.id]),onClick:a=>a.stopPropagation(),placeholder:"Add internal notes...",rows:3})]}),s.status==="Planning"&&e.jsxs("button",{className:"convert-project-btn",onClick:a=>{a.stopPropagation(),Q(s)},children:[e.jsx(ne,{size:16}),"Convert to Active Project"]})]}),e.jsxs("div",{className:"updates-section",children:[e.jsx("h4",{children:"Update Timeline"}),e.jsxs("div",{className:"update-form",children:[e.jsx("input",{type:"text",value:r[s.id]||"",onChange:a=>C({...r,[s.id]:a.target.value}),onKeyDown:a=>{a.key==="Enter"&&r[s.id]?.trim()&&(A(s.id,r[s.id].trim()),C({...r,[s.id]:""}))},onClick:a=>a.stopPropagation(),placeholder:"Add an update..."}),e.jsx("button",{onClick:a=>{a.stopPropagation(),r[s.id]?.trim()&&(A(s.id,r[s.id].trim()),C({...r,[s.id]:""}))},children:"Add"})]}),e.jsx("div",{className:"updates-list",children:d[s.id]?.map((a,i)=>e.jsxs("div",{className:"update-item",children:[e.jsx(T,{size:14}),e.jsxs("div",{children:[e.jsx("p",{children:a.text}),e.jsx("span",{className:"update-time",children:new Date(a.timestamp).toLocaleString()})]})]},i))||e.jsx("p",{className:"no-updates",children:"No updates yet"})})]})]})]},s.id)})})})]})};export{pe as default};

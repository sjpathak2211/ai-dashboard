const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ProgressChart-BgGizDi3.js","assets/motion-Bqg1F435.js","assets/charts-BdExecV6.js","assets/react-vendor-vtvkNrF5.js"])))=>i.map(i=>d[i]);
import{_ as F}from"./supabase-Zg5kSs2N.js";import{j as e,A as k,m as L}from"./motion-Bqg1F435.js";import{r as c}from"./charts-BdExecV6.js";import{r as z,s as y,a as A}from"./index-Be5jfDu-.js";import{X as M,f as O,U as $,g as H,h as R,T as S,C as D,b as q,c as w,A as P,i as Y}from"./icons-BKnbkRve.js";import"./react-vendor-vtvkNrF5.js";const B=({isOpen:r,onClose:l,request:n,onUpdate:b})=>{const[a,v]=c.useState({description:"",department:"",priority:"",estimatedImpact:"",contactInfo:""}),[i,g]=c.useState({}),[h,f]=c.useState(!1),N=["Clinical Operations","IT","Research","Quality Assurance","Administration","Finance"],p=["High","Medium","Low"];c.useEffect(()=>{n&&v({description:n.description,department:n.department,priority:n.priority,estimatedImpact:n.estimatedImpact,contactInfo:n.contactInfo})},[n]);const I=()=>{const t={};a.description.trim()||(t.description="Description is required"),a.department||(t.department="Department is required"),a.priority||(t.priority="Priority is required"),a.estimatedImpact.trim()||(t.estimatedImpact="Estimated impact is required"),a.contactInfo.trim()||(t.contactInfo="Contact information is required");const u=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return a.contactInfo&&!u.test(a.contactInfo)&&(t.contactInfo="Please enter a valid email address"),g(t),Object.keys(t).length===0},C=async t=>{if(t.preventDefault(),!(!I()||!n)){f(!0);try{await z.updateRequest(n.id,{description:a.description,department:a.department,priority:a.priority,estimatedImpact:a.estimatedImpact,contactInfo:a.contactInfo}),b(),l()}catch(u){console.error("Failed to update request:",u),alert("Failed to update request. Please try again.")}finally{f(!1)}}},m=(t,u)=>{v(j=>({...j,[t]:u})),i[t]&&g(j=>({...j,[t]:""}))};return!r||!n?null:e.jsx(k,{children:e.jsx("div",{className:"modal-overlay",onClick:l,children:e.jsxs(L.div,{className:"edit-modal-content",initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{duration:.2},onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Edit Request"}),e.jsx("button",{className:"close-button",onClick:l,"aria-label":"Close modal",children:e.jsx(M,{size:24})})]}),e.jsxs("div",{className:"request-title-display",children:[e.jsx("label",{children:"Title (Cannot be edited)"}),e.jsx("p",{className:"title-readonly",children:n.title})]}),e.jsxs("form",{onSubmit:C,className:"modal-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",children:"Description *"}),e.jsx("textarea",{id:"description",value:a.description,onChange:t=>m("description",t.target.value),className:i.description?"error":"",placeholder:"Describe the AI initiative, its goals, and expected outcomes",rows:4}),i.description&&e.jsx("span",{className:"error-text",children:i.description})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"department",children:"Department/Team *"}),e.jsxs("select",{id:"department",value:a.department,onChange:t=>m("department",t.target.value),className:i.department?"error":"",children:[e.jsx("option",{value:"",children:"Select Department"}),N.map(t=>e.jsx("option",{value:t,children:t},t))]}),i.department&&e.jsx("span",{className:"error-text",children:i.department})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"priority",children:"Priority Level *"}),e.jsxs("select",{id:"priority",value:a.priority,onChange:t=>m("priority",t.target.value),className:i.priority?"error":"",children:[e.jsx("option",{value:"",children:"Select Priority"}),p.map(t=>e.jsx("option",{value:t,children:t},t))]}),i.priority&&e.jsx("span",{className:"error-text",children:i.priority})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"estimatedImpact",children:"Estimated Impact *"}),e.jsx("textarea",{id:"estimatedImpact",value:a.estimatedImpact,onChange:t=>m("estimatedImpact",t.target.value),className:i.estimatedImpact?"error":"",placeholder:"Describe the expected impact, benefits, and potential metrics",rows:3}),i.estimatedImpact&&e.jsx("span",{className:"error-text",children:i.estimatedImpact})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"contactInfo",children:"Contact Information *"}),e.jsx("input",{id:"contactInfo",type:"email",value:a.contactInfo,onChange:t=>m("contactInfo",t.target.value),className:i.contactInfo?"error":"",placeholder:"your.email@ascendcohealth.com"}),i.contactInfo&&e.jsx("span",{className:"error-text",children:i.contactInfo})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"secondary",onClick:l,disabled:h,children:"Cancel"}),e.jsxs("button",{type:"submit",className:"primary",disabled:h,children:[e.jsx(O,{size:16}),h?"Saving...":"Save Changes"]})]})]})]})})})},J=c.lazy(()=>F(()=>import("./ProgressChart-BgGizDi3.js"),__vite__mapDeps([0,1,2,3]))),Z=({user:r})=>{const[l,n]=c.useState([]),[b,a]=c.useState([]),[v,i]=c.useState(!0),[g,h]=c.useState(null),[f,N]=c.useState(!1);c.useEffect(()=>{const s=async()=>{try{const[d,T]=await Promise.all([z.getUserRequests(r.id),A.getUserActivities(r.id,5)]);n(d),a(T)}catch(d){console.error("Failed to fetch user data:",d)}finally{i(!1)}};s();const o=y.subscribeToRequests(d=>{(d.new?.user_id===r.id||d.old?.user_id===r.id)&&s()}),x=y.subscribeToActivities(d=>{d.new?.user_id===r.id&&A.getUserActivities(r.id,5).then(a)});return()=>{y.unsubscribe(o),y.unsubscribe(x)}},[r.id]);const p=l.filter(s=>s.status==="In Progress"||s.status==="Testing"),I=s=>{switch(s){case"Planning":return e.jsx(q,{size:16,className:"status-icon planning"});case"In Progress":return e.jsx(S,{size:16,className:"status-icon in-progress"});case"Testing":return e.jsx(D,{size:16,className:"status-icon testing"});case"Complete":return e.jsx(w,{size:16,className:"status-icon complete"});default:return e.jsx(q,{size:16,className:"status-icon"})}},C=s=>s.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),m=s=>{const x=Math.floor((new Date().getTime()-s.getTime())/(1e3*60*60));return x<1?"Just now":x<24?`${x}h ago`:`${Math.floor(x/24)}d ago`},t=s=>{switch(s){case"project_created":return e.jsx(Y,{size:16});case"project_updated":return e.jsx(P,{size:16});case"request_submitted":return e.jsx(q,{size:16});case"request_updated":return e.jsx(S,{size:16});case"project_completed":return e.jsx(w,{size:16});default:return e.jsx(P,{size:16})}},j=(s=>s.length===0?[]:s.map(o=>({name:o.title.substring(0,20)+(o.title.length>20?"...":""),progress:o.progress||0,id:o.id})))(p),E=s=>{h(s),N(!0)},_=()=>{h(null),N(!1)},U=()=>{(async()=>{try{const o=await z.getUserRequests(r.id);n(o)}catch(o){console.error("Failed to refresh requests:",o)}})()};return v?e.jsx("div",{className:"user-dashboard",children:e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading your dashboard..."})]})}):e.jsxs("div",{className:"user-dashboard",children:[e.jsx("div",{className:"user-dashboard-header",children:e.jsxs("div",{className:"user-info",children:[r.picture?e.jsx("img",{src:r.picture,alt:r.name,className:"user-avatar"}):e.jsx("div",{className:"user-avatar-placeholder",children:e.jsx($,{size:24})}),e.jsxs("div",{className:"user-details",children:[e.jsxs("h2",{children:["Welcome back, ",r.name.split(" ")[0],"!"]}),e.jsx("p",{children:"Here's your AI request dashboard"})]})]})}),e.jsxs("div",{className:"user-dashboard-content",children:[e.jsxs("div",{className:"user-dashboard-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Your Recent Requests"}),e.jsxs("span",{className:"request-count",children:[l.length," total requests"]})]}),e.jsx("div",{className:"requests-list",children:l.length>0?l.slice(0,5).map(s=>e.jsxs("div",{className:"request-item",children:[e.jsxs("div",{className:"request-item-header",children:[e.jsxs("div",{className:"request-title-section",children:[e.jsx("h4",{children:s.title}),e.jsxs("div",{className:`request-status ${s.status.toLowerCase().replace(" ","-")}`,children:[I(s.status),s.status]})]}),e.jsx("button",{className:"edit-request-button",onClick:()=>E(s),title:"Edit request",children:e.jsx(H,{size:16})})]}),e.jsx("p",{className:"request-description",children:s.description}),e.jsxs("div",{className:"request-meta",children:[e.jsxs("div",{className:"meta-item",children:[e.jsx(R,{size:14}),e.jsxs("span",{children:["Submitted: ",C(s.submittedAt)]})]}),s.progress!==void 0&&s.progress>0&&e.jsxs("div",{className:"meta-item",children:[e.jsx(S,{size:14}),e.jsxs("span",{children:["Progress: ",s.progress,"%"]})]})]}),s.adminNotes&&e.jsxs("div",{className:"admin-notes",children:[e.jsx("strong",{children:"Latest Update:"})," ",s.adminNotes]})]},s.id)):e.jsxs("div",{className:"empty-state",children:[e.jsx(D,{size:48,className:"empty-state-icon"}),e.jsx("h4",{children:"No requests yet"}),e.jsx("p",{children:"Submit your first AI request to get started!"})]})})]}),e.jsxs("div",{className:"user-dashboard-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Progress on Active Requests"}),e.jsxs("span",{className:"active-count",children:[p.length," active"]})]}),e.jsx("div",{className:"progress-section",children:p.length>0?e.jsxs("div",{className:"progress-chart-container",children:[e.jsx(c.Suspense,{fallback:e.jsx("div",{style:{height:300,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("div",{className:"loading-spinner"})}),children:e.jsx(J,{data:j})}),e.jsx("div",{className:"active-requests-details",children:p.map(s=>e.jsx("div",{className:"active-request-detail",children:e.jsxs("div",{className:"request-progress-bar",children:[e.jsxs("div",{className:"progress-info",children:[e.jsx("span",{className:"request-name",children:s.title}),e.jsxs("span",{className:"progress-percentage",children:[s.progress,"%"]})]}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${s.progress}%`}})})]})},s.id))})]}):e.jsx("div",{className:"no-active-requests",children:e.jsxs("div",{className:"no-active-content",children:[e.jsx(D,{size:64,className:"no-active-icon"}),e.jsx("h4",{children:"You have no active requests right now!"}),e.jsx("p",{children:"Once your requests are approved and moved to active status, you'll see their progress here."})]})})})]})]}),e.jsxs("div",{className:"recent-activity-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Recent Activity"}),e.jsx(R,{size:20,className:"activity-header-icon"})]}),e.jsx("div",{className:"activity-list",children:b.map(s=>e.jsxs("div",{className:"activity-item",children:[e.jsx("div",{className:"activity-item-icon",children:t(s.type)}),e.jsxs("div",{className:"activity-item-content",children:[e.jsx("h4",{children:s.title}),e.jsx("p",{children:s.description}),e.jsxs("div",{className:"activity-meta",children:[e.jsx("span",{className:"activity-user",children:s.user}),e.jsx("span",{className:"activity-time",children:m(s.timestamp)})]})]})]},s.id))})]}),e.jsx(B,{isOpen:f,onClose:_,request:g,onUpdate:U})]})};export{Z as default};

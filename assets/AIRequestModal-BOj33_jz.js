import{j as e,A as F,m as k}from"./motion-Bqg1F435.js";import{r as o}from"./charts-BdExecV6.js";import{b as q,r as E}from"./index-C9aOTM3y.js";import{B as I,X as A,U as T,l as z,m as M,I as D,b as R,n as G}from"./icons-BKnbkRve.js";import"./react-vendor-vtvkNrF5.js";import"./supabase-Zg5kSs2N.js";const C={async generateFormFields(c){try{const s=await fetch("/api/marshal",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:c,type:"generate"})});if(!s.ok){const i=await s.text();throw console.error("Marshal API error response:",s.status,i),new Error(`Marshal API request failed: ${s.status}`)}const d=await s.json();return console.log("Marshal API response for form generation:",d),d}catch(s){throw console.error("Marshal API error:",s),s}},async getChatResponse(c){try{const s=await fetch("/api/marshal",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:c,type:"chat"})});if(!s.ok){const i=await s.text();throw console.error("Marshal API error response:",s.status,i),new Error(`Marshal API request failed: ${s.status}`)}const d=await s.json();return console.log("Marshal API response:",d),d.response}catch(s){throw console.error("Marshal API error:",s),s}}},L="Hi! I'm Marshal, your AI assistant. I'm here to help you create a comprehensive AI project request. Could you start by telling me about the problem or opportunity you'd like to address with AI?",B=({isOpen:c,onClose:s,onFormGenerated:d})=>{const[i,r]=o.useState([{role:"assistant",content:L}]),[m,l]=o.useState(""),[u,x]=o.useState(!1),[y,a]=o.useState(!1),j=o.useRef(null),b=()=>{j.current?.scrollIntoView({behavior:"smooth"})};o.useEffect(()=>{b()},[i]);const g=async()=>{if(!m.trim()||u)return;const n=m.trim();l("");const h=[...i,{role:"user",content:n}];r(h),x(!0);try{console.log("Sending messages to Claude:",h);const v=await C.getChatResponse(h);r([...h,{role:"assistant",content:v}])}catch(v){console.error("Failed to get AI response:",v),r([...h,{role:"assistant",content:"I apologize, but I encountered an error. Please try again or fill out the form manually."}])}finally{x(!1)}},N=async()=>{if(i.length<3){alert("Please have a conversation with Marshal first to provide more details about your project.");return}a(!0);try{const n=await C.generateFormFields(i);d(n),r([...i,{role:"assistant",content:"Great! I've generated the form fields based on our conversation. Feel free to review and edit them as needed before submitting."}])}catch(n){console.error("Failed to generate form:",n),alert("Failed to generate form fields. Please try again.")}finally{a(!1)}},w=n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),g())};return c?e.jsx(F,{children:e.jsxs(k.div,{className:"marshal-chat-container",initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},children:[e.jsxs("div",{className:"marshal-chat-header",children:[e.jsxs("div",{className:"marshal-info",children:[e.jsx("div",{className:"marshal-avatar",children:e.jsx(I,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{children:"Marshal AI Assistant"}),e.jsx("p",{children:"Let's create your AI project request together"})]})]}),e.jsx("button",{className:"marshal-close-btn",onClick:s,children:e.jsx(A,{size:20})})]}),e.jsxs("div",{className:"marshal-chat-messages",children:[i.map((n,h)=>e.jsxs("div",{className:`marshal-message ${n.role}`,children:[e.jsx("div",{className:"message-avatar",children:n.role==="assistant"?e.jsx(I,{size:16}):e.jsx(T,{size:16})}),e.jsx("div",{className:"message-content",children:e.jsx("p",{children:n.content})})]},h)),u&&e.jsxs("div",{className:"marshal-message assistant",children:[e.jsx("div",{className:"message-avatar",children:e.jsx(I,{size:16})}),e.jsx("div",{className:"message-content",children:e.jsxs("div",{className:"typing-indicator",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})})]}),e.jsx("div",{ref:j})]}),e.jsxs("div",{className:"marshal-chat-footer",children:[i.length>=3&&e.jsxs("button",{className:"generate-form-btn",onClick:N,disabled:y,children:[e.jsx(z,{size:16}),y?"Generating...":"Generate Form Fields"]}),e.jsxs("div",{className:"marshal-chat-input",children:[e.jsx("textarea",{value:m,onChange:n=>l(n.target.value),onKeyDown:w,placeholder:"Type your message...",rows:1,disabled:u}),e.jsx("button",{onClick:g,disabled:!m.trim()||u,className:"send-btn",children:e.jsx(M,{size:16})})]})]})]})}):null},U=({isOpen:c,onClose:s,onSubmit:d,user:i})=>{const[r,m]=o.useState({title:"",description:"",department:"",priority:"",estimatedImpact:"",contactInfo:i?.email||""}),[l,u]=o.useState({status:"busy",message:"Currently working on several high-priority projects. New requests may take longer than usual.",estimatedWaitTime:"2-3 weeks"}),[x,y]=o.useState(!1),[a,j]=o.useState({}),[b,g]=o.useState(!1);o.useEffect(()=>{c&&q.getBacklogStatus().then(u).catch(t=>console.error("Failed to fetch backlog status:",t))},[c]),o.useEffect(()=>{i?.email&&m(t=>({...t,contactInfo:i.email}))},[i?.email]);const N=["Clinical Operations","IT","Research","Quality Assurance","Administration","Finance"],w=["High","Medium","Low"],n=()=>{const t={};r.title.trim()||(t.title="Title is required"),r.description.trim()||(t.description="Description is required"),r.department||(t.department="Department is required"),r.priority||(t.priority="Priority is required"),r.estimatedImpact.trim()||(t.estimatedImpact="Estimated impact is required"),r.contactInfo.trim()||(t.contactInfo="Contact information is required");const p=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return r.contactInfo&&!p.test(r.contactInfo)&&(t.contactInfo="Please enter a valid email address"),j(t),Object.keys(t).length===0},h=async t=>{t.preventDefault(),n()&&await v()},v=async()=>{if(!x){y(!0);try{const t=await E.createRequest({...r,status:"Planning",progress:0});console.log("Request saved successfully:",t),d({...r,status:"Planning"}),m({title:"",description:"",department:"",priority:"",estimatedImpact:"",contactInfo:i?.email||""}),j({}),s()}catch(t){console.error("Failed to submit request:",t);const p=t?.message||"Failed to submit request. Please try again.";alert(p)}finally{y(!1)}}},f=(t,p)=>{m(S=>({...S,[t]:p})),a[t]&&j(S=>({...S,[t]:""}))},P=t=>{m(p=>({...p,title:t.title,description:t.description,estimatedImpact:t.estimatedImpact})),g(!1)};return c?e.jsxs(F,{children:[e.jsx("div",{className:"modal-overlay",onClick:s,children:e.jsx(k.div,{className:"modal-content",initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{duration:.2},onClick:t=>t.stopPropagation(),children:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Submit New AI Request"}),e.jsx("button",{className:"close-button",onClick:s,"aria-label":"Close modal",children:e.jsx(A,{size:24})})]}),e.jsxs("div",{className:`backlog-warning ${l.status}`,children:[e.jsxs("div",{className:"backlog-warning-icon",children:[l.status==="clear"&&e.jsx(D,{size:20}),l.status==="busy"&&e.jsx(R,{size:20}),l.status==="swamped"&&e.jsx(G,{size:20})]}),e.jsxs("div",{className:"backlog-warning-content",children:[e.jsxs("h4",{children:[l.status==="clear"&&"Good News!",l.status==="busy"&&"Please Note",l.status==="swamped"&&"Important Notice"]}),e.jsx("p",{children:l.message}),e.jsxs("span",{className:"backlog-estimate",children:["Estimated response time: ",e.jsx("strong",{children:l.estimatedWaitTime})]})]})]}),e.jsxs("div",{className:"marshal-button-container",children:[e.jsxs("button",{type:"button",className:"marshal-button",onClick:()=>g(!0),children:[e.jsx(I,{size:20}),e.jsx("span",{children:"Generate with Marshal AI"})]}),e.jsx("p",{className:"marshal-hint",children:"Let Marshal help you create a comprehensive request"})]}),e.jsxs("form",{onSubmit:h,className:"modal-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"title",children:"Project/Idea Title *"}),e.jsx("input",{id:"title",type:"text",value:r.title,onChange:t=>f("title",t.target.value),className:a.title?"error":"",placeholder:"Enter a descriptive title for your AI initiative"}),a.title&&e.jsx("span",{className:"error-text",children:a.title})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",children:"Description *"}),e.jsx("textarea",{id:"description",value:r.description,onChange:t=>f("description",t.target.value),className:a.description?"error":"",placeholder:"Describe the AI initiative, its goals, and expected outcomes",rows:4}),a.description&&e.jsx("span",{className:"error-text",children:a.description})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"department",children:"Department/Team *"}),e.jsxs("select",{id:"department",value:r.department,onChange:t=>f("department",t.target.value),className:a.department?"error":"",children:[e.jsx("option",{value:"",children:"Select Department"}),N.map(t=>e.jsx("option",{value:t,children:t},t))]}),a.department&&e.jsx("span",{className:"error-text",children:a.department})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"priority",children:"Priority Level *"}),e.jsxs("select",{id:"priority",value:r.priority,onChange:t=>f("priority",t.target.value),className:a.priority?"error":"",children:[e.jsx("option",{value:"",children:"Select Priority"}),w.map(t=>e.jsx("option",{value:t,children:t},t))]}),a.priority&&e.jsx("span",{className:"error-text",children:a.priority})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"estimatedImpact",children:"Estimated Impact *"}),e.jsx("textarea",{id:"estimatedImpact",value:r.estimatedImpact,onChange:t=>f("estimatedImpact",t.target.value),className:a.estimatedImpact?"error":"",placeholder:"Describe the expected impact, benefits, and potential metrics",rows:3}),a.estimatedImpact&&e.jsx("span",{className:"error-text",children:a.estimatedImpact})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"contactInfo",children:"Contact Information *"}),e.jsx("input",{id:"contactInfo",type:"email",value:r.contactInfo,onChange:t=>f("contactInfo",t.target.value),className:a.contactInfo?"error":"",placeholder:"your.email@ascendcohealth.com"}),a.contactInfo&&e.jsx("span",{className:"error-text",children:a.contactInfo})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"secondary",onClick:s,children:"Cancel"}),e.jsxs("button",{type:"submit",className:"primary",disabled:x,children:[e.jsx(M,{size:16}),x?"Submitting...":"Submit Request"]})]})]})]})})}),e.jsx(B,{isOpen:b,onClose:()=>g(!1),onFormGenerated:P})]}):null};export{U as default};

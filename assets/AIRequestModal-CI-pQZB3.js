import{j as e,A as P,m as F}from"./motion-Bqg1F435.js";import{r as o}from"./charts-BdExecV6.js";import{b as E,r as T}from"./index-Be5jfDu-.js";import{B as I,X as k,U as R,l as z,m as M,I as D,b as G,n as L}from"./icons-BKnbkRve.js";import"./react-vendor-vtvkNrF5.js";import"./supabase-Zg5kSs2N.js";const A=()=>null,C={async generateFormFields(d){const l=A();if(!l)throw new Error("AI assistant is currently unavailable. Please deploy the API server or set VITE_API_URL.");try{const r=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:d,type:"generate"})});if(!r.ok){const s=await r.text();throw console.error("Marshal API error response:",r.status,s),new Error(`Marshal API request failed: ${r.status}`)}const i=await r.json();return console.log("Marshal API response for form generation:",i),i}catch(r){throw console.error("Marshal API error:",r),r}},async getChatResponse(d){const l=A();if(!l)throw new Error("AI assistant is currently unavailable. Please deploy the API server or set VITE_API_URL.");try{const r=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:d,type:"chat"})});if(!r.ok){const s=await r.text();throw console.error("Marshal API error response:",r.status,s),new Error(`Marshal API request failed: ${r.status}`)}const i=await r.json();return console.log("Marshal API response:",i),i.response}catch(r){throw console.error("Marshal API error:",r),r}}},U="Hi! I'm Marshal, your AI assistant. I'm here to help you create a comprehensive AI project request. Could you start by telling me about the problem or opportunity you'd like to address with AI?",B=({isOpen:d,onClose:l,onFormGenerated:r})=>{const[i,s]=o.useState([{role:"assistant",content:U}]),[m,c]=o.useState(""),[p,x]=o.useState(!1),[y,a]=o.useState(!1),j=o.useRef(null),b=()=>{j.current?.scrollIntoView({behavior:"smooth"})};o.useEffect(()=>{b()},[i]);const f=async()=>{if(!m.trim()||p)return;const n=m.trim();c("");const h=[...i,{role:"user",content:n}];s(h),x(!0);try{console.log("Sending messages to Claude:",h);const v=await C.getChatResponse(h);s([...h,{role:"assistant",content:v}])}catch(v){console.error("Failed to get AI response:",v),s([...h,{role:"assistant",content:"I apologize, but I encountered an error. Please try again or fill out the form manually."}])}finally{x(!1)}},N=async()=>{if(i.length<3){alert("Please have a conversation with Marshal first to provide more details about your project.");return}a(!0);try{const n=await C.generateFormFields(i);r(n),s([...i,{role:"assistant",content:"Great! I've generated the form fields based on our conversation. Feel free to review and edit them as needed before submitting."}])}catch(n){console.error("Failed to generate form:",n),alert("Failed to generate form fields. Please try again.")}finally{a(!1)}},w=n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),f())};return d?e.jsx(P,{children:e.jsxs(F.div,{className:"marshal-chat-container",initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},children:[e.jsxs("div",{className:"marshal-chat-header",children:[e.jsxs("div",{className:"marshal-info",children:[e.jsx("div",{className:"marshal-avatar",children:e.jsx(I,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{children:"Marshal AI Assistant"}),e.jsx("p",{children:"Let's create your AI project request together"})]})]}),e.jsx("button",{className:"marshal-close-btn",onClick:l,children:e.jsx(k,{size:20})})]}),e.jsxs("div",{className:"marshal-chat-messages",children:[i.map((n,h)=>e.jsxs("div",{className:`marshal-message ${n.role}`,children:[e.jsx("div",{className:"message-avatar",children:n.role==="assistant"?e.jsx(I,{size:16}):e.jsx(R,{size:16})}),e.jsx("div",{className:"message-content",children:e.jsx("p",{children:n.content})})]},h)),p&&e.jsxs("div",{className:"marshal-message assistant",children:[e.jsx("div",{className:"message-avatar",children:e.jsx(I,{size:16})}),e.jsx("div",{className:"message-content",children:e.jsxs("div",{className:"typing-indicator",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]})})]}),e.jsx("div",{ref:j})]}),e.jsxs("div",{className:"marshal-chat-footer",children:[i.length>=3&&e.jsxs("button",{className:"generate-form-btn",onClick:N,disabled:y,children:[e.jsx(z,{size:16}),y?"Generating...":"Generate Form Fields"]}),e.jsxs("div",{className:"marshal-chat-input",children:[e.jsx("textarea",{value:m,onChange:n=>c(n.target.value),onKeyDown:w,placeholder:"Type your message...",rows:1,disabled:p}),e.jsx("button",{onClick:f,disabled:!m.trim()||p,className:"send-btn",children:e.jsx(M,{size:16})})]})]})]})}):null},J=({isOpen:d,onClose:l,onSubmit:r,user:i})=>{const[s,m]=o.useState({title:"",description:"",department:"",priority:"",estimatedImpact:"",contactInfo:i?.email||""}),[c,p]=o.useState({status:"busy",message:"Currently working on several high-priority projects. New requests may take longer than usual.",estimatedWaitTime:"2-3 weeks"}),[x,y]=o.useState(!1),[a,j]=o.useState({}),[b,f]=o.useState(!1);o.useEffect(()=>{d&&E.getBacklogStatus().then(p).catch(t=>console.error("Failed to fetch backlog status:",t))},[d]),o.useEffect(()=>{i?.email&&m(t=>({...t,contactInfo:i.email}))},[i?.email]);const N=["Clinical Operations","IT","Research","Quality Assurance","Administration","Finance"],w=["High","Medium","Low"],n=()=>{const t={};s.title.trim()||(t.title="Title is required"),s.description.trim()||(t.description="Description is required"),s.department||(t.department="Department is required"),s.priority||(t.priority="Priority is required"),s.estimatedImpact.trim()||(t.estimatedImpact="Estimated impact is required"),s.contactInfo.trim()||(t.contactInfo="Contact information is required");const u=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return s.contactInfo&&!u.test(s.contactInfo)&&(t.contactInfo="Please enter a valid email address"),j(t),Object.keys(t).length===0},h=async t=>{t.preventDefault(),n()&&await v()},v=async()=>{if(!x){y(!0);try{const t=await T.createRequest({...s,status:"Planning",progress:0});console.log("Request saved successfully:",t),r({...s,status:"Planning"}),m({title:"",description:"",department:"",priority:"",estimatedImpact:"",contactInfo:i?.email||""}),j({}),l()}catch(t){console.error("Failed to submit request:",t);const u=t?.message||"Failed to submit request. Please try again.";alert(u)}finally{y(!1)}}},g=(t,u)=>{m(S=>({...S,[t]:u})),a[t]&&j(S=>({...S,[t]:""}))},q=t=>{m(u=>({...u,title:t.title,description:t.description,estimatedImpact:t.estimatedImpact})),f(!1)};return d?e.jsxs(P,{children:[e.jsx("div",{className:"modal-overlay",onClick:l,children:e.jsx(F.div,{className:"modal-content",initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{duration:.2},onClick:t=>t.stopPropagation(),children:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Submit New AI Request"}),e.jsx("button",{className:"close-button",onClick:l,"aria-label":"Close modal",children:e.jsx(k,{size:24})})]}),e.jsxs("div",{className:`backlog-warning ${c.status}`,children:[e.jsxs("div",{className:"backlog-warning-icon",children:[c.status==="clear"&&e.jsx(D,{size:20}),c.status==="busy"&&e.jsx(G,{size:20}),c.status==="swamped"&&e.jsx(L,{size:20})]}),e.jsxs("div",{className:"backlog-warning-content",children:[e.jsxs("h4",{children:[c.status==="clear"&&"Good News!",c.status==="busy"&&"Please Note",c.status==="swamped"&&"Important Notice"]}),e.jsx("p",{children:c.message}),e.jsxs("span",{className:"backlog-estimate",children:["Estimated response time: ",e.jsx("strong",{children:c.estimatedWaitTime})]})]})]}),e.jsxs("div",{className:"marshal-button-container",children:[e.jsxs("button",{type:"button",className:"marshal-button",onClick:()=>f(!0),children:[e.jsx(I,{size:20}),e.jsx("span",{children:"Generate with Marshal AI"})]}),e.jsx("p",{className:"marshal-hint",children:"Let Marshal help you create a comprehensive request"})]}),e.jsxs("form",{onSubmit:h,className:"modal-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"title",children:"Project/Idea Title *"}),e.jsx("input",{id:"title",type:"text",value:s.title,onChange:t=>g("title",t.target.value),className:a.title?"error":"",placeholder:"Enter a descriptive title for your AI initiative"}),a.title&&e.jsx("span",{className:"error-text",children:a.title})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",children:"Description *"}),e.jsx("textarea",{id:"description",value:s.description,onChange:t=>g("description",t.target.value),className:a.description?"error":"",placeholder:"Describe the AI initiative, its goals, and expected outcomes",rows:4}),a.description&&e.jsx("span",{className:"error-text",children:a.description})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"department",children:"Department/Team *"}),e.jsxs("select",{id:"department",value:s.department,onChange:t=>g("department",t.target.value),className:a.department?"error":"",children:[e.jsx("option",{value:"",children:"Select Department"}),N.map(t=>e.jsx("option",{value:t,children:t},t))]}),a.department&&e.jsx("span",{className:"error-text",children:a.department})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"priority",children:"Priority Level *"}),e.jsxs("select",{id:"priority",value:s.priority,onChange:t=>g("priority",t.target.value),className:a.priority?"error":"",children:[e.jsx("option",{value:"",children:"Select Priority"}),w.map(t=>e.jsx("option",{value:t,children:t},t))]}),a.priority&&e.jsx("span",{className:"error-text",children:a.priority})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"estimatedImpact",children:"Estimated Impact *"}),e.jsx("textarea",{id:"estimatedImpact",value:s.estimatedImpact,onChange:t=>g("estimatedImpact",t.target.value),className:a.estimatedImpact?"error":"",placeholder:"Describe the expected impact, benefits, and potential metrics",rows:3}),a.estimatedImpact&&e.jsx("span",{className:"error-text",children:a.estimatedImpact})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"contactInfo",children:"Contact Information *"}),e.jsx("input",{id:"contactInfo",type:"email",value:s.contactInfo,onChange:t=>g("contactInfo",t.target.value),className:a.contactInfo?"error":"",placeholder:"your.email@ascendcohealth.com"}),a.contactInfo&&e.jsx("span",{className:"error-text",children:a.contactInfo})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"secondary",onClick:l,children:"Cancel"}),e.jsxs("button",{type:"submit",className:"primary",disabled:x,children:[e.jsx(M,{size:16}),x?"Submitting...":"Submit Request"]})]})]})]})})}),e.jsx(B,{isOpen:b,onClose:()=>f(!1),onFormGenerated:q})]}):null};export{J as default};
